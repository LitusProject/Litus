{% extends 'site/base.twig' %}

{% block content %}
    {% if sportInfo is not null %}
        <div class="alert alert-info">
            <h4>{{ translate('24h Run') }}</h4>
            {% if sportInfo.behind == 0 %}
                {{ translate('We have run already %laps% laps and we are the first team.')|replace({'%laps%': sportInfo.nbLaps}) }}
            {% else %}
                {{ translate('We have run already %laps% laps and we are %behind% laps behind the first team.')|replace({'%laps%': sportInfo.nbLaps, '%behind%': sportInfo.behind}) }}
            {% endif %}
            <span class="pull-right">{{ translate('Current Runner:') }} <b>{{ sportInfo.currentLap.getRunner().getFullName() }}</b></span>
        </div>
    {% endif %}

    {% if bookings is not null %}
        <div class="alert alert-success">
            <p>
                <a class="pull-right hidden-xs hidden-sm" href="{{ url('cudi_booking') }}" style="color:inherit">{{ translate('View Bookings') }}</a>
                <b>{{ translate('New bookings have been assigned to you, and you can go and collect them.') }}</b>
            </p>

            <ul>
                {% for booking in bookings %}
                    <li>{{ booking.getArticle().getMainArticle().getTitle() }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    {% for notification in notifications %}
        <div class="alert alert-info notification">
            {{ markdown(notification.getContent(language)) }}
        </div>
    {% endfor %}

    <div class="row">
        <div class="col-md-4">
            <a class="heading" href="{{ url('calendar') }}">
                <h2>
                    <span class="glyphicon glyphicon-calendar"></span>
                    {{ translate('Calendar') }}
                </h2>
            </a>

            {% for day in calendarItems %}
                <div class="item">
                    <span class="date left">{{ dateLocalized(day.date, 'd MMM') }}</span>

                    <p class="calendarItem">
                        {% for event in day.events %}
                            <i class="icon-time"></i> <a href="{{ url('calendar', {'action': 'view', 'name': event.getName()}) }}" rel="popover" data-original-title="{{ event.getTitle(language) }}" data-content="{{ event.getSummary(200, language) }}">{{ dateLocalized(event.getStartDate(), 'HH:mm') }}&mdash;{{ event.getTitle(language) }}</a><br />
                        {% endfor %}
                    </p>
                </div>
            {% else %}
                <div class="heading-spacer"></div>

                <div class="alert">
                    {{ translate('No events were created yet.') }}
                </div>
            {% endfor %}
        </div>

        <div class="col-md-3">
            <a class="heading" href="{{ url('cudi_booking') }}">
                <h2>
                    <span class="glyphicon glyphicon-book"></span>
                    {{ translate('Bookstore') }}
                </h2>
            </a>

            {% if hasAccess('cudi_booking', 'view') %}
                <p><a href="{{ url('cudi_booking') }}" class="btn btn-primary">{{ translate('Reservations') }}</a></p>
            {% endif %}

            {% if cudi.currentOpeningHour %}
                <h3>{{ translate('Open Session') }}</h3>
                {% autoescape false %}
                    <p>
                        {{ translate('Cudi is open until <span class="badge badge-warning">%time%</span>.')|replace({'%time%': dateLocalized(cudi.currentOpeningHour.getEnd(), 'H:mm')}) }}
                        {% if cudi.currentOpeningHour.getComment(language)|length > 0 %}
                            <br><small style="margin-left: 20px;">{{ cudi.currentOpeningHour.getComment(language) }}</small>
                        {% endif %}
                    </p>
                {% endautoescape %}

                {% if cudi.currentSession %}
                    {% autoescape false %}
                        <p>
                            {% if cudi.currentStudents == 1 %}
                                {{ translate('Currently there is <span class="badge badge-info">%number%</span> student in the queue at Cudi.')|replace({'%number%': cudi.currentStudents}) }}
                            {% else %}
                                {{ translate('Currently there are <span class="badge badge-info">%number%</span> students in the queue at Cudi.')|replace({'%number%': cudi.currentStudents}) }}
                            {% endif %}
                        </p>
                    {% endautoescape %}
                {% endif %}
            {% endif %}

            {% if cudi.openingHours|length > 0 %}
                <h3>{{ translate('Opening Hours') }}</h3>

                {% set previousDay = '' %}
                {% for openingHour in cudi.openingHours %}
                    <div>
                        {% if previousDay != openingHour.getStart().format('d/M') %}
                            <div class="label label-info" style="display: block; width: 110px; text-align: center;">
                                {{ dateLocalized(openingHour.getStart(), 'EEEE (d/M)')|capitalize }}
                            </div>
                        {% endif %}
                        <div style="margin-left: 20px;">
                            {% if openingHour.getComment(language)|length > 0 %}
                                <b>{{ dateLocalized(openingHour.getStart(), 'H:mm') }}&mdash;{{ dateLocalized(openingHour.getEnd(), 'H:mm') }}:</b>
                                <small>{{ openingHour.getComment(language) }}</small>
                            {% else %}
                                <b>{{ dateLocalized(openingHour.getStart(), 'H:mm') }}&mdash;{{ dateLocalized(openingHour.getEnd(), 'H:mm') }}</b>
                            {% endif %}
                        </div>
                        {% set previousDay = openingHour.getStart().format('d/M') %}
                    </div>
                {% endfor %}
            {% endif %}

            {% if myShifts is not null and myShifts|length > 0 %}
                <a class="heading" href="{{ url('shift') }}">
                    <h2>
                        <span class="glyphicon glyphicon-tasks"></span>
                        {{ translate('Shifts') }}
                    </h2>
                </a>

                {% for shift in myShifts %}
                    <div class="accordion-group" id="group_{{ accordionName }}_shift-{{ shift.getId() }}">
                        <div class="accordion-heading">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#shifts-{{ accordionName }}" href="#collapse_{{ accordionName }}_shift-{{ shift.getId() }}" style="overflow: hidden;">
                                {{ shift.getName() }}
                            </a>
                        </div>
                        <div id="collapse_{{ accordionName }}_shift-{{ shift.getId() }}" class="accordion-body collapse">
                            <div class="accordion-inner">
                                <div>
                                    <dl>
                                        <dt>{{ translate('Name') }}</dt>
                                        <dd>{{ shift.getName() }}</dd>
                                        <dt>{{ translate('Start') }}</dt>
                                        <dd>{{ dateLocalized(shift.getStartDate(), 'd/M/y HH:mm') }}</dd>
                                        <dt>{{ translate('End') }}</dt>
                                        <dd>{{ dateLocalized(shift.getEndDate(), 'd/M/y HH:mm') }}</dd>
                                    </dl>
                                </div>
                                <div>
                                    <dl>
                                        <dt>{{ translate('Description') }}</dt>
                                        <dd style="text-align: justify;">{{ shift.getDescription() }}</dd>
                                        <dt>{{ translate('Location') }}</dt>
                                        <dd>{{ shift.getLocation().getName() }}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        </div>

        <div class="col-md-5">
            <a class="heading" href="{{ url('news') }}">
                <h2>
                    <span class="glyphicon glyphicon-inbox"></span>
                    {{ translate('News') }}
                </h2>
            </a>

            {% for item in newsItems %}
                <div class="item date-right">
                    <h4 class="date right">{{ dateLocalized(item.getCreationTime(), 'd MMM') }}</h4>

                    <h3>{{ item.getTitle(language) }}</h3>

                    <blockquote>{{ hideEmail(markdown(item.getSummary(200, language)))|striptags }}
                        &mdash; <a href="{{ url('news', {'action': 'view', 'name': item.getName(language)}) }}">{{ translate('Read More') }}</a>
                    </blockquote>
                </div>
            {% else %}
                <div class="heading-spacer"></div>

                <div class="alert">
                    {{ translate('No news items were posted yet.') }}
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}

{% block content_script %}
    <script type="text/javascript">
        $('a[rel=popover]').popover({'trigger': 'hover', 'html': true});
    </script>
{% endblock %}
