{% extends 'run/base.twig' %}

{% block content %}
    <div class="page-header">
        <h1>{{ translate('Group of Friends') }}</h1>
    </div>

    <div class="row">
        <div class="span3 columns justify">
            <p>
                {{ translate('A group of friends is a small team of runners. Each team must choose 2 slots of 2 hours during the run. During these happy hours, you get 2 points for each lap. When you run outside of these hours, each lap earns you one point. Off course, the group who has collected the most points at the end of the run wins!') }}
            </p>
        </div>
        <div class="span9 columns">
            {% import 'site/partials/form.twig' as forms %}
            {{ forms.renderForm(form) }}
        </div>
    </div>
{% endblock %}

{% block content_script %}
    <script type="text/javascript">
        $(document).ready(function () {
            $('[id^=university_identification]').bind('keyup blur', getName);

            showHideFieldset('one', 'two');
            showHideFieldset('two', 'three');
            showHideFieldset('three', 'four');
            showHideFieldset('four', 'five');

            $('[id^=university_identification]').each(function () {
                $(this).trigger('keyup');
            });
        });

        function showHideFieldset(show, hide) {
            $('#user_' + hide).hide();

            $('#university_identification_' + show).bind('keyup blur', function() {
                if (8 == $('#university_identification_' + show).val().length)
                    $('#user_' + hide).fadeIn('slow');
            });
        }

        function getName() {
            var $this = $(this);
            if (8 == $(this).val().length) {
                $.get('{{ url('run_group', {"action": "getName"})}}' +  $(this).val(), function (data) {
                    if (data && 'success' == data.status) {
                        var fieldSet = $this.closest('fieldset');
                        console.log(fieldSet);

                        fieldSet.find('[id^=first_name]').val(data.firstName).addClass('uneditable-input').attr('disabled', 'disabled');
                        fieldSet.find('[id^=last_name]').val(data.lastName).addClass('uneditable-input').attr('disabled', 'disabled');
                    }
                }, 'json');
            }
        }
    </script>
{% endblock %}