{% extends 'run/base.twig' %}

{% block content %}
    <div class="page-header">
        <h1>{{ translate('Group of Friends') }}</h1>
    </div>

    <div class="row">
        <div class="col-md-3 justify">
            <p>
                {{ translate('A group of friends consists of a few runners. Each group has to pick two time slots with a duration of 2 hours. You will receive points for every lap beneath 1\'30". The faster you run,  the more points you get per lap. You pick "happy hours" where your points will count double. If VTK does not have enough runners and you decide to come run for us, your points will also count double. The group with the most points wins!') }}
            </p>
        </div>
        <div class="col-md-9">
            {% import 'site/partials/form.twig' as forms %}
            {{ forms.renderForm(form) }}
        </div>
    </div>
{% endblock %}

{% block content_script %}
    <script type="text/javascript">
        $(document).ready(function () {
            $('[id^=university_identification]').bind('keyup blur', getName);

            showHideFieldset('one', 'two');
            showHideFieldset('two', 'three');
            showHideFieldset('three', 'four');
            showHideFieldset('four', 'five');

            $('[id^=university_identification]').each(function () {
                $(this).trigger('keyup');
            });
        });

        function showHideFieldset(show, hide) {
            $('#user_' + hide).hide();

            $('#university_identification_' + show).bind('keyup blur', function() {
                if (8 == $('#university_identification_' + show).val().length)
                    $('#user_' + hide).fadeIn('slow');
            });
        }

        function getName() {
            var $this = $(this);
            if (8 == $(this).val().length) {
                $.get('{{ url('sport_run_group', {"action": "getName"})}}' +  $(this).val(), function (data) {
                    if (data && 'success' == data.status) {
                        var fieldSet = $this.closest('fieldset');

                        fieldSet.find('[id^=first_name]').val(data.firstName).addClass('uneditable-input').attr('disabled', 'disabled');
                        fieldSet.find('[id^=last_name]').val(data.lastName).addClass('uneditable-input').attr('disabled', 'disabled');
                    }
                }, 'json');
            }
        }
    </script>
{% endblock %}
