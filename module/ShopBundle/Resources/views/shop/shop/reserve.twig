{% extends 'site/base.twig' %}

{% block content %}
    {% import 'admin/partials/form.twig' as forms %}

    <div class="page-header">
        <h1>{{ translate('Reserve') }}</h1>
    </div>

    {% include 'shop/shop/partials/navigation.twig' %}

    <div class="flashmessage alert alert-success fade" id="success">
        <div class="content">
            {{ translate('Your reservation was successful!') }}
        </div>
    </div>
    <div class="flashmessage alert alert-danger fade" id="error">
        <div class="content">
            {{ translate('An error occurred while processing your reservation!') }}
        </div>
    </div>

    <div style="text-align: justify;">
        {% if canReserve %}
            {{ translate("You can reserve some items from the shop. Be aware that you might lose the permission to reserve items if you don't come and buy your reserved items on the right date.") }}
            <div>
                {% if salesSessionsAvailable %}
                    {% autoescape false %}
                        {{ form().openTag(form) }}
                        {{ formElement(form.get('csrf')) }}
                        {% if form.get('salesSession') %}
                            {{ formElement(form.get('salesSession')) }}
                        {% endif %}
                        <br>
                        <table class="table table-condensed table-striped">
                            {% for product in products %}
                                <tr>
                                    <td>
                                        {{ product.getName() }}
                                    </td>
                                    <td>
                                        &euro; {{ product.getSellPrice() }}
                                    </td>
                                    <td width="60" style="text-align:center;">
                                        {% set name = 'product-' ~ product.getId() %}
                                        {% set element = form.get(name) %}
                                        {{ formElement(element) }}
                                        <a href="#" class="decrease-value"><span
                                                    class="glyphicon glyphicon-minus-sign pull-left"
                                                    style="margin-top: 3px;"></span></a>
                                        <b>0</b>
                                        <a href="#" class="increase-value"><span
                                                    class="glyphicon glyphicon-plus-sign pull-right"
                                                    style="margin-top: 3px;"></span></a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </table>
                        {% if form.get('submit') %}
                            {{ formElement(form.get('submit')) }}
                        {% endif %}


                        {{ form().closeTag() }}

                    {% endautoescape %}
                {% else %}
                    {{ translate("However, there are no future sales sessions open for reservations yet.") }}
                {% endif %}
            </div>
        {% else %}
            {{ translate("You cannot reserve items from the shop. This privilege might require you to do some shifts in the shop.") }}
        {% endif %}
    </div>

{% endblock %}

{% block content_script %}
    <script type="text/javascript">
        $(document).ready(function () {
            $('.increase-value').click(function (e) {
                e.preventDefault();
                var newAmount = parseInt($(e.target).closest('td').find('b').html(), 10) + 1;

                $(e.target).closest('td').find('b').html(newAmount);
                $(e.target).closest('td').find('input').val(newAmount);
            });

            $('.decrease-value').click(function (e) {
                e.preventDefault();
                var newAmount = parseInt($(e.target).closest('td').find('b').html(), 10) - 1;

                if (newAmount >= 0) {
                    $(e.target).closest('td').find('b').html(newAmount);
                    $(e.target).closest('td').find('input').val(newAmount);
                }
            });
        });
    </script>
{% endblock %}
