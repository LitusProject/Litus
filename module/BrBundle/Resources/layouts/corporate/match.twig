{% extends 'corporate/base.twig' %}

{% block content %}
    <div class="container">

        <div style="height: 40px"></div>

        <h2>{{ translate("Your Matching Profile") }}</h2>
        <div class="pageTitleDeco"></div>

        <div style="height: 20px"></div>

        <div class="br-blueBanner" style="padding: 20px;">
            <h3 style="color:white;">{{ translate('Find your match with our students!') }}</h3>
            <p style="color: white;">{{ bannerText }}</p>
            <div style="height: 20px;"></div>
            {% if needs_sp and needs_cp %}
                <div style="color:white;"><h4 style="color:white;">{{ translate('You are not ready to match yet!') }}</h4>{{ translate('Please create your Profile so you can start matching!') }}</div>
            {% elseif needs_sp or needs_cp %}
                <div style="color:white;"><h4 style="color:white;">{{ translate('You are not ready to match yet!') }}</h4>{{ translate('Please finish creating your Profile so you can start matching!') }}</div>
            {% endif %}
            <div style="height: 20px;"></div>

            {% if needs_cp %}
                <a class="button yellow unfilled" href="{{ url('br_corporate_match', {'action': 'addProfile', 'type': 'company' }) }}">{{ translate('Create Profile') }}</a>
            {% elseif needs_sp %}
                <a class="button yellow unfilled" href="{{ url('br_corporate_match', {'action': 'addProfile', 'type': 'student' }) }}">{{ translate('Create Profile') }}</a>
            {% else %}
                <a class="button yellow unfilled" href="{{ url('br_corporate_match', {'action': 'viewProfile' }) }}">{{ translate('View Profile') }}</a>
            {% endif %}
        </div>

        <div style="height: 20px;"></div>
        <h2>Matches</h2>
        <div class="pageTitleDeco"></div>
        <div style="height: 20px"></div>
        {% include 'br/corporate/match/partials/navigation.twig' %}
        <div style="height: 20px"></div>

        <div class="row">
{#            <div class="col-md-3"></div>#}

            <div class="col-md-12">
                <table class="table table-hover full-width">
                    {% for match in matches %}
                        <tr>
                            <td>
                                <strong>{{ match.getStudent().getFullName() }}</strong>
                                <br/>
                                {{ match.getStudent().getEMail() }}
                                <br/>
                                {{ match.getMatchPercentage() }} %
                            </td>
                            <td width="230" style="vertical-align: middle;">
                                {% if match.getStudentCV(entityManager, academicYearObject) and entries %}
                                    <a class="button blue pull-right cv_search" data-toggle="modal" data-target="#searchCV-{{ match.getId() }}">{{ translate('View CV') }}</a>
                                {% endif %}
                            </td>
                        </tr>
                    {% else %}
                        <p>{{ translate('No matches were found...') }}</p>
                    {% endfor %}
                </table>

                {% include 'site/partials/paginationControl.twig' %}
            </div>
        </div>
    </div>

    <div class="flashmessage alert alert-danger full_width search_error hide">
        <div class="title">{{ translate('Error') }}</div>
        <div class="content">
            <p>{{ translate('An error occurred while trying to perform the search.') }}</p>
        </div>
    </div>

    {% for entry in entries %}
        <div class="modal fade" id="searchCV-{{ entry['id'] }}" tabindex="-1">
            <div class="modal-dialog" style="width: 50%">
                <div class="modal-content">
                    <div class="modal-header">
                        <a class="close" data-dismiss="modal">&times;</a>
                        <h3>CV</h3>
                    </div>
                    <div class="modal-body">
                        {% import 'corporate/partials/showcv.twig' as cv %}
                        {{ cv.displayEntry(entry['cv'], profilePath, gradesMapEnabled, gradesMap) }}
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
{% endblock %}

{% block content_script %}
    <script type="text/javascript">
        $(document).ready(function() {
            $('.cv_search').bind("click", function(){

            });
        });


    </script>
{% endblock %}