{% extends 'career/partials/layout.twig' %}

{% block page_content %}
    <div class="container">

        <div class="pageTitleHolder">
            <h3>{{ event.getTitle(language) }}: QR code</h3>
            <div class="pageTitleDeco"></div>
        </div>
        <div class="spacer40"></div>

        <a class="button blue unfilled" href="{{ url('br_career_event',{ 'action': 'view', 'id': event.getId() }) }}">← {{ translate('Return to the event information') }}</a>

        <div style="height: 5px"></div>

        {% if entry is not null %}
            {# In other words, it is either entry or exit #}
            
            <div class="page-header">
                <h3>{{ subscription.getFirstName() }} {{ subscription.getLastName() }}</h3>
            </div>
            {% if entry %}
                <h2>Welcome</h2>
                {% if firstTime %}
                    <h3>This person is entering for the first time</h3>
                {% else %}
                    <h3>This person has entered before</h3>
                {% endif %}
                

                <div class="row" style="height: 100px; justify-content: center; align-items: center;">
                    <div class="col-sm-12" style="background-color: {{color}};border: 1px solid black">
                        <h3 style="color: {{textColor}};"> {{ subscription.getStudyString() }}</h3>
                    </div>
                    {% if subscription.getStudyYear() == 'phd' %}
                        <h3 style="color: Crimson">PhD</h3>
                    {% endif %}
                </div>
            {% else  %}
                <h2>Goodbye</h2>

                <p>This person should be exiting the building.</p>

            {% endif %}

        {% elseif match is not null %}
            <div class="page-header">
                <h3>{{ match.getSubscription().getFirstName() }} {{ match.getSubscription().getLastName() }} ({% if duplicate %}Duplicate{% else %}New{% endif %} Match)</h3>
            </div>
            <p>Study: {{match.getSubscription().getStudyString()}}</p>
            {% if match.getSubscription().getSpecialization() != '' %}
                <p>Specialization: {{ match.getSubscription().getSpecialization() }}</p>
            {% endif %}
            <p>E-mail: {{match.getSubscription().getEmail()}}</p>
            {% if match.getSubscription().getPhoneNumber() != '' %}
                <p>Phone number: {{ match.getSubscription().getPhoneNumber() }}</p>
            {% endif %}
            <div style="height: 50px"></div>

            <div>
                <div>
                    <textarea rows="10" style="width: 80%" class="note_text" data-content="{{ match.getNotes() }}"></textarea>
                </div>
                <button style="margin-top: 2%" class="button btn-info btn-sm save-note">Save Notes</button>
            </div>

            <div style="height: 50px"></div>
            <a class="button blue unfilled" href="{{ url('br_career_event',{ 'action': 'overviewMatches', 'id': event.getId() }) }}">{{ translate('View your matches here') }} →</a>
        {% else %}
            <div class="page-header">
                <h3>QR code</h3>
            </div>
            <div class="row">
                
                <div class="col-sm-12">
                    <p>You have arrived on this page after following the link of the QR code. No extra information can be found on this page.</p>
                    <p>If something should happen, check whether you are correctly logged in. If everything seems correct but it still doesn't work, contact our IT team.</p>
                </div>
                <div class="col-sm-4">
                    <img src="{{qrSource}}" alt="QR code of this page generated by an api of google">
                </div>
            </div>

        {% endif %}


    </div>
{% endblock %}

{% block content_script %}
    <script type="text/javascript">
        $(document).ready(function() {
            var match_id =  {{ match.getId() }};

            let text_area = $('.note_text');
            let old_note = $(text_area).data('content');

            text_area.val(old_note);

            $(document).on('click', '.save-note', function (e) {
                e.preventDefault();

                let new_notes = $('.note_text').val();
                $.post('{{ url('br_career_event', {"action": "updateNotes", "id": event.getId()}) }}match/' + match_id, JSON.stringify({'note': new_notes, }));
            });
        })
    </script>
{% endblock %}