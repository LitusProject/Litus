/**
 * @license jCanvas v13.12.19
 * Copyright 2013 Caleb Evans
 * Released under the MIT license
 */(function(e,t,n,r,i,s,o,u,a){function A(e){var t=this;l(t,e);return t}function O(e){e?l(A.prototype,e):O.prefs=A.prototype=l({},f);return this}function M(e){return h(e)==="string"}function _(e){return e&&e.getContext?e.getContext("2d"):u}function D(e){e=l({},e);e.masks=e.masks.slice(0);return e}function P(e,t){var n;e.save();n=D(t.transforms);t.savedTransforms.push(n)}function H(e,t){if(t.savedTransforms.length===0)t.transforms=D(C);else{e.restore();t.transforms=t.savedTransforms.pop()}}function B(e,t,n){p(n.fillStyle)?t.fillStyle=n.fillStyle.call(e,n):t.fillStyle=n.fillStyle;p(n.strokeStyle)?t.strokeStyle=n.strokeStyle.call(e,n):t.strokeStyle=n.strokeStyle;t.lineWidth=n.strokeWidth;if(n.rounded)t.lineCap=t.lineJoin="round";else{t.lineCap=n.strokeCap;t.lineJoin=n.strokeJoin;t.miterLimit=n.miterLimit}t.shadowOffsetX=n.shadowX;t.shadowOffsetY=n.shadowY;t.shadowBlur=n.shadowBlur;t.shadowColor=n.shadowColor;t.globalAlpha=n.opacity;t.globalCompositeOperation=n.compositing;n.imageSmoothing&&(t.webkitImageSmoothingEnabled=t.mozImageSmoothingEnabled=n.imageSmoothing)}function j(e,t,n){if(n.mask){n.autosave&&P(e,t);e.clip();t.transforms.masks.push(n._args)}}function F(e,t){t._transformed&&e.restore()}function I(e,t,n){var r;n.closed&&t.closePath();if(n.shadowStroke&&n.strokeWidth!==0){t.stroke();t.fill();t.shadowColor="transparent";t.shadowBlur=0;t.stroke()}else{t.fill();n.fillStyle!=="transparent"&&(t.shadowColor="transparent");n.strokeWidth!==0&&t.stroke()}n.closed||t.closePath();F(t,n);if(n.mask){r=W(e);j(t,r,n)}}function q(e,t,n){t._toRad=t.inDegrees?v/180:1;e.translate(t.x,t.y);e.rotate(t.rotate*t._toRad);e.translate(-t.x,-t.y);n&&(n.rotate+=t.rotate*t._toRad)}function R(e,t,n){t.scale!==1&&(t.scaleX=t.scaleY=t.scale);e.translate(t.x,t.y);e.scale(t.scaleX,t.scaleY);e.translate(-t.x,-t.y);if(n){n.scaleX*=t.scaleX;n.scaleY*=t.scaleY}}function U(e,t,n){t.translate&&(t.translateX=t.translateY=t.translate);e.translate(t.translateX,t.translateY);if(n){n.translateX+=t.translateX;n.translateY+=t.translateY}}function z(e,t,n,r,i){n._toRad=n.inDegrees?v/180:1;n.arrowAngle*=n._toRad;n._transformed=s;t.save();i===a&&(i=r);if(!n.fromCenter&&!n._centered&&r!==a&&i!==a){n.x+=r/2;n.y+=i/2;n._centered=s}n.rotate&&q(t,n,{});(n.scale!==1||n.scaleX!==1||n.scaleY!==1)&&R(t,n,{});(n.translate||n.translateX||n.translateY)&&U(t,n,{})}function W(t){var n;if(x._canvas===t&&x._data)n=x._data;else{n=e.data(t,"jCanvas");if(!n){n={canvas:t,layers:[],layer:{names:{},groups:{}},eventHooks:{},intersecting:[],lastIntersected:u,cursor:e(t).css("cursor"),drag:{},event:{type:u,x:u,y:u},events:{},transforms:D(C),savedTransforms:[],animating:o,animated:u,pos:0,pixelRatio:1,scaled:!1};e.data(t,"jCanvas",n)}x._canvas=t;x._data=n}return n}function X(e,t,n){var r;for(r in O.events)O.events.hasOwnProperty(r)&&(n[r]||n.cursors&&n.cursors[r])&&V(e,t,n,r)}function V(e,t,n,r){r=at(r);O.events[r](e,t);n._event=s}function $(e,t,n){var r,i,o;if(n.draggable||n.cursor||n.cursors){r=["mousedown","mousemove","mouseup"];for(o=0;o<r.length;o+=1){i=r[o];V(e,t,n,i)}if(!t.events.mouseoutdrag){e.bind("mouseout.jCanvas",function(){var n=t.drag.layer;if(n){t.drag={};n.dragcancel&&n.dragcancel.call(e[0],n);e.drawLayers()}});t.events.mouseoutdrag=s}n._event=s}}function J(e,t,n,r){var i=t.layer.names;r?r.name!==a&&M(n.name)&&n.name!==r.name&&delete i[n.name]:r=n;M(r.name)&&(i[r.name]=n)}function K(e,t,n,r){var i=t.layer.groups,s,o,f,l,c;if(n.group!==u){n.groups=[n.group];n.dragGroupWithLayer&&(n.dragGroups=[n.group])}if(r&&r.group!==a)if(r.group===u)r.groups=u;else{r.groups=[r.group];r.dragGroupWithLayer&&(r.dragGroups=[r.group])}if(!r)r=n;else if(r.groups!==a&&n.groups!==u)for(f=0;f<n.groups.length;f+=1){o=n.groups[f];s=i[o];if(s){for(c=0;c<s.length;c+=1)if(s[c]===n){l=c;s.splice(c,1);break}s.length===0&&delete i[o]}}if(r.groups!==a&&r.groups!==u)for(f=0;f<r.groups.length;f+=1){o=r.groups[f];s=i[o];if(!s){s=i[o]=[];s.name=o}l===a&&(l=s.length);s.splice(l,0,n)}}function Q(e){var t,n,r;t={};for(n=e.intersecting.length-1;n>=0;n-=1){t=e.intersecting[n];if(t._masks){for(r=t._masks.length-1;r>=0;r-=1)if(!t._masks[r].intersects){t.intersects=o;break}if(t.intersects)break}}return t}function G(e,t,n,r){if(n&&n.visible&&n._method){r?n._next=r:n._next=u;n._method.call(e,n)}}function Y(e,t,n){var r,i,u,a,f,l,c,h,p,d;a=t.drag;i=a.layer;f=i.dragGroups||[];r=t.layers;if(n==="mousemove"||n==="touchmove"){if(!a.dragging){a.dragging=s;if(i.bringToFront){r.splice(i.index,1);i.index=r.push(i)}i._startX=i.x;i._startY=i.y;i._endX=i._eventX;i._endY=i._eventY;et(e,t,i,"dragstart")}if(a.dragging){p=i._eventX-(i._endX-i._startX);d=i._eventY-(i._endY-i._startY);i.dx=p-i.x;i.dy=d-i.y;i.x=p;i.y=d;et(e,t,i,"drag");for(h=0;h<f.length;h+=1){c=f[h];l=t.layer.groups[c];if(i.groups&&l)for(u=0;u<l.length;u+=1)if(l[u]!==i){l[u].x+=i.dx;l[u].y+=i.dy}}}}else if(n==="mouseup"||n==="touchend"){if(a.dragging){et(e,t,i,"dragstop");a.dragging=o}t.drag={}}}function Z(e,t,n,r){t.eventHooks[r]&&t.eventHooks[r].call(e[0],n)}function et(e,t,n,r,i){i||(n.cursors?i=n.cursors[r]:i=n.cursor);i&&e.css({cursor:i});n[r]&&n[r].call(e[0],n);Z(e,t,n,r);Z(e,O,n,r)}function tt(t,n,r,i){var o,a,f=n,l;n._args=r;n.canvas=t;if(n.draggable||n.dragGroups){n.layer=s;n.draggable=s}i?n._method=i:n.method?n._method=e.fn[n.method]:n.type?n._method=e.fn[S[n.type]]:n._method=function(){};if(n.layer&&!n._layer){o=e(t);a=o.getLayers();l=W(t);f=new A(n);f.layer=s;f._layer=s;f._data=l;J(o,l,f);K(o,l,f);X(o,l,f);$(o,l,f);n._event=f._event;f.index===u&&(f.index=a.length);a.splice(f.index,0,f);n._args=f;et(o,l,f,"add")}return f}function nt(e){var t,n;for(n=0;n<k.length;n+=1){t=k[n];e[t]=e["_"+t]}}function rt(e,t){var n,r;for(r=0;r<k.length;r+=1){n=k[r];e["_"+n]=e[n];L[n]=s;t&&delete e[n]}}function it(e,t,n){var r;for(r in n)n.hasOwnProperty(r)&&p(n[r])&&(n[r]=n[r].call(e,t,r));return n}function st(n){var r,s,o=[],u=1;if(n.match(/^#?\w+$/gi)){n==="transparent"&&(n="rgba(0,0,0,0)");s=t.head;r=s.style.color;s.style.color=n;n=e.css(s,"color");s.style.color=r}if(n.match(/^rgb/gi)){o=n.match(/\d+/gi);n.match(/%/gi)&&(u=2.55);o[0]*=u;o[1]*=u;o[2]*=u;o[3]!==a?o[3]=i(o[3]):o[3]=1}return o}function ot(e){var t=3,n;if(h(e.start)!=="array"){e.start=st(e.start);e.end=st(e.end)}e.now=[];if(e.start[3]!==1||e.end[3]!==1)t=4;for(n=0;n<t;n+=1){e.now[n]=e.start[n]+(e.end[n]-e.start[n])*e.pos;n<3&&(e.now[n]=d(e.now[n]))}if(e.start[3]!==1||e.end[3]!==1)e.now="rgba("+e.now.join(",")+")";else{e.now.slice(0,3);e.now="rgb("+e.now.join(",")+")"}e.elem.nodeName?e.elem.style[e.prop]=e.now:e.elem[e.prop]=e.now}function ut(t){var n;for(n=0;n<t.length;n+=1)e.fx.step[t[n]]=ot}function at(e){window.ontouchstart!==undefined&&w[e]&&(e=w[e]);return e}function ft(e){E[e]&&(e=E[e]);return e}function lt(e){O.events[e]=function(t,n){var r,i;i=n.event;r=e==="mouseover"||e==="mouseout"?"mousemove":e;if(!n.events[r]){t.bind(r+".jCanvas",function(e){i.x=e.offsetX;i.y=e.offsetY;i.type=r;i.event=e;t.drawLayers({resetFire:s});e.preventDefault()});n.events[r]=s}}}function ct(e){var t;for(t=0;t<e.length;t+=1)lt(e[t])}function ht(e,t,n){var r,i,s,o,a,f,l,c;r=n._args;if(r&&r._event){i=W(e);s=i.event;if(s.x!==u&&s.y!==u){f=s.x*i.pixelRatio;l=s.y*i.pixelRatio;o=t.isPointInPath(f,l)||t.isPointInStroke&&t.isPointInStroke(f,l)}a=i.transforms;r.eventX=r.mouseX=s.x;r.eventY=r.mouseY=s.y;r.event=s.event;c=i.transforms.rotate;f=r.eventX;l=r.eventY;if(c!==0){r._eventX=f*g(-c)-l*m(-c);r._eventY=l*g(-c)+f*m(-c)}else{r._eventX=f;r._eventY=l}r._eventX/=a.scaleX;r._eventY/=a.scaleY;o&&i.intersecting.push(r);r.intersects=o}}function pt(e){while(e<0)e+=2*v;return e}function dt(e,t){return e.x+e.radius*g(t)}function vt(e,t){return e.y+e.radius*m(t)}function mt(e,t,n,r,i,s,o){var u,a,f,l,c,h,p;if(n.arrowRadius&&!n.closed){p=y(o-i,s-r);p-=v;c=n.strokeWidth*g(p);h=n.strokeWidth*m(p);u=s+n.arrowRadius*g(p+n.arrowAngle/2);a=o+n.arrowRadius*m(p+n.arrowAngle/2);f=s+n.arrowRadius*g(p-n.arrowAngle/2);l=o+n.arrowRadius*m(p-n.arrowAngle/2);t.moveTo(u-c,a-h);t.lineTo(s-c,o-h);t.lineTo(f-c,l-h);t.moveTo(s-c,o-h);t.lineTo(s+c,o+h)}}function gt(e,t,n,r,i,s,o,u,a,f,l){n.startArrow&&mt(e,t,n,r,i,s,o);n.endArrow&&mt(e,t,n,u,a,f,l)}function yt(e,t){isNaN(Number(t.fontSize))||(t.fontSize+="px");e.font=t.fontStyle+" "+t.fontSize+" "+t.fontFamily}function bt(t,n,r,s){var o,u,a;if(T.text===r.text&&T.fontStyle===r.fontStyle&&T.fontSize===r.fontSize&&T.fontFamily===r.fontFamily&&T.maxWidth===r.maxWidth&&T.lineHeight===r.lineHeight){r.width=T.width;r.height=T.height}else{r.width=n.measureText(s[0]).width;for(a=1;a<s.length;a+=1){u=n.measureText(s[a]).width;u>r.width&&(r.width=u)}o=t.style.fontSize;t.style.fontSize=r.fontSize;r.height=i(e.css(t,"fontSize"))*s.length*r.lineHeight;t.style.fontSize=o}}function wt(e,t){var n=t.text,r=t.maxWidth,i=n.split("\n"),s=[],o,u,a,f,l,c;for(a=0;a<i.length;a+=1){f=i[a];l=f.split(" ");o=[];u="";if(l.length===1||e.measureText(f).width<r)o=[f];else{for(c=0;c<l.length;c+=1){if(e.measureText(u+l[c]).width>r){u!==""&&o.push(u);u=""}u+=l[c];c!==l.length-1&&(u+=" ")}o.push(u)}s=s.concat(o.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n"))}return s}var f,l=e.extend,c=e.inArray,h=e.type,p=e.isFunction,d=r.round,v=r.PI,m=r.sin,g=r.cos,y=r.atan2,b=e.event.fix,w,E,S,x={},T={},N={},C={rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,masks:[]},k,L;e.fn.jCanvas=O;O.events={};O.eventHooks={};f={align:"center",arrowAngle:90,arrowRadius:0,autosave:s,baseline:"middle",bringToFront:o,ccw:o,closed:o,compositing:"source-over",concavity:0,cornerRadius:0,count:1,cropFromCenter:s,cursor:u,cursors:u,disableEvents:o,draggable:o,dragGroups:u,group:u,groups:u,data:{},dx:0,dy:u,each:u,end:360,eventX:u,eventY:u,fillStyle:"transparent",fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:s,fn:u,height:u,imageSmoothing:s,inDegrees:s,index:u,lineHeight:1,layer:o,load:u,mask:o,maxWidth:u,miterLimit:10,name:u,opacity:1,r1:u,r2:u,radius:0,repeat:"repeat",respectAlign:o,rotate:0,rounded:o,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowStroke:!1,shadowX:0,shadowY:0,sHeight:u,sides:0,source:"",spread:0,start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:u,sx:u,sy:u,text:"",translate:0,translateX:0,translateY:0,type:u,visible:s,width:u,x:0,y:0};O();O.extend=function(n){O.defaults=l(f,n.props);O();if(n.name){e.fn[n.name]=function r(e){var t=this,i,s,o,u,a;for(s=0;s<t.length;s+=1){i=t[s];o=_(i);if(o){u=new A(e);a=tt(i,u,e,r);B(i,o,u);n.fn.call(i,o,u)}}return t};n.type&&S[n.type]===a&&(S[n.type]=n.name)}return e.fn[n.name]};e.fn.getLayers=function(t){var n=this[0],r,i,s,o=[];if(n&&n.getContext){r=W(n);i=r.layers;if(p(t))for(s=0;s<i.length;s+=1)t.call(n,i[s])&&o.push(i[s]);else o=i}return o};e.fn.getLayer=function(t){var n=this[0],r=W(n),i=r.layers,s=h(t),o,u;if(t&&t.layer)o=t;else if(s==="number"){t<0&&(t=i.length+t);o=i[t]}else if(s==="regexp"){for(u=0;u<i.length;u+=1)if(M(i[u].name)&&i[u].name.match(t)){o=i[u];break}}else o=r.layer.names[t];return o};e.fn.getLayerGroup=function(t){var n=this[0],r=h(t),i,s,o,u;if(r==="array")return t;if(r==="regexp"){u=W(n);i=u.groups;for(s in i)if(s.match(t)){o=i[s];break}}else{u=W(n);o=u.layer.groups[t]}return o};e.fn.getLayerIndex=function(t){var n=this,r=n.getLayers(),i=n.getLayer(t);return c(i,r)};e.fn.getEventHooks=function(){var t=this[0],n=W(t);return n.eventHooks};e.fn.setLayer=function(n,r){var i=this,s,o,u,f;for(o=0;o<i.length;o+=1){s=e(i[o]);u=W(i[o]);f=e(i[o]).getLayer(n);if(f){J(s,u,f,r);K(s,u,f,r);r.index!==a&&s.moveLayer(f,r.index);l(f,r);X(s,u,f);$(s,u,f);et(s,u,f,"change")}}return i};e.fn.setLayerGroup=function(n,r){var i=this,s,o,u,a;for(o=0;o<i.length;o+=1){s=e(i[o]);u=s.getLayerGroup(n);if(u)for(a=0;a<u.length;a+=1)s.setLayer(u[a],r)}return i};e.fn.setLayers=function(n,r){var i=this,s,o,u,a;for(o=0;o<i.length;o+=1){s=e(i[o]);u=s.getLayers(r);for(a=0;a<u.length;a+=1)s.setLayer(u[a],n)}return i};e.fn.setEventHooks=function(n){var r=this,i,s,o;for(s=0;s<r.length;s+=1){i=e(r[s]);o=W(r[s]);l(o.eventHooks,n)}return r};e.fn.moveLayer=function(n,r){var i=this,s,o,u,a,f;for(o=0;o<i.length;o+=1){s=e(i[o]);u=W(i[o]);a=u.layers;f=s.getLayer(n);if(f){f.index=c(f,a);a.splice(f.index,1);a.splice(r,0,f);r<0&&(r=a.length+r);f.index=r;et(s,u,f,"move")}}return i};e.fn.removeLayer=function(n){var r=this,i,s,o,a,f;for(s=0;s<r.length;s+=1){i=e(r[s]);o=W(r[s]);a=i.getLayers();f=i.getLayer(n);if(f){f.index=c(f,a);a.splice(f.index,1);J(i,o,f,{name:u});K(i,o,f,{groups:u});et(i,o,f,"remove")}}return r};e.fn.removeLayerGroup=function(n){var r=this,i,s,o,f,l,h,p;if(n!==a)for(s=0;s<r.length;s+=1){i=e(r[s]);o=W(r[s]);f=i.getLayers();l=i.getLayerGroup(n);if(l){for(p=0;p<l.length;p+=1){h=l[p];h.index=c(h,f);f.splice(h.index,1);J(i,o,h,{name:u})}delete o.layer.groups[l.name]}}return r};e.fn.removeLayers=function(){var n=this,r,i,s,o;for(i=0;i<n.length;i+=1){r=e(n[i]);s=W(n[i]);for(o=0;o<s.layers.length;o+=1){r.removeLayer(o);o-=1}s.layer.names={};s.layer.groups={}}return n};e.fn.addLayerToGroup=function(n,r){var i=this,s,o,u,a=[];for(o=0;o<i.length;o+=1){s=e(i[o]);u=s.getLayer(n);if(u.groups&&c(r,u.groups)===-1){a=u.groups.slice(0);a.push(r);s.setLayer(u,{groups:a})}}return i};e.fn.removeLayerFromGroup=function(n,r){var i=this,s,o,u,a=[],f;for(o=0;o<i.length;o+=1){s=e(i[o]);u=s.getLayer(n);f=c(r,u.groups);if(f!==-1){a=u.groups.slice(0);a.splice(f,1);s.setLayer(u,{groups:a})}}return i};e.fn.drawLayer=function(n){var r=this,i,s,o,u;for(i=0;i<r.length;i+=1){o=e(r[i]);s=_(r[i]);u=o.getLayer(n);G(o,s,u)}return r};e.fn.drawLayers=function(n){var r=this,i,a,f,c=l({},n),h,p,d,v,m,g,y,b,w;c.index||(c.index=0);for(a=0;a<r.length;a+=1){i=e(r[a]);f=_(r[a]);if(f){g=W(r[a]);c.clear!==o&&i.clearCanvas();h=g.layers;for(v=c.index;v<h.length;v+=1){p=h[v];p.index=v;c.resetFire&&(p._fired=o);p._event=!p.disableEvents;G(i,f,p,v+1);p._masks=g.transforms.masks.slice(0);if(p._method===e.fn.drawImage&&p.visible)break}m=v;p=Q(g);y=g.event;b=y.type;p[b]||(b=ft(b));w=g.drag;d=g.lastIntersected;if(d!==u&&p!==d&&d._hovered&&!d._fired){g.lastIntersected=u;d._fired=s;d._hovered=o;et(i,g,d,"mouseout",g.cursor)}if(p._event&&p.intersects){g.lastIntersected=p;if(p.mouseover||p.mouseout||p.cursor||p.cursors)if(!p._hovered&&!p._fired){p._fired=s;p._hovered=s;et(i,g,p,"mouseover")}if(!p._fired){p._fired=s;y.type=u;et(i,g,p,b)}p.draggable&&(b==="mousedown"||b==="touchstart")&&(w.layer=p)}w.layer&&Y(i,g,b);if(m===h.length){g.intersecting.length=0;g.transforms=D(C);g.savedTransforms.length=0}}}return r};e.fn.addLayer=function(t){var n=this,r,i,o;for(r=0;r<n.length;r+=1){i=_(n[r]);if(i){o=new A(t);o.layer=s;tt(n[r],o,t)}}return n};k=["width","height","opacity","lineHeight"];L={};e.fn.animateLayer=function(){function g(e,t,n){return function(){nt(n);(!t.animating||t.animated===n)&&e.drawLayers();c[4]&&c[4].call(e[0],n);n._animating=o;t.animating=o;t.animated=u}}function y(e,t,n){return function(r,i){if(n._pos!==i.pos){n._pos=i.pos;nt(n);if(!n._animating&&!t.animating){n._animating=s;t.animating=s;t.animated=n}(!t.animating||t.animated===n)&&e.drawLayers();c[5]&&c[5].call(e[0],r,i,n)}}}var n=this,r,i,f,c=[].slice.call(arguments,0),d,v,m;if(h(c[2])==="object"){c.splice(2,0,c[2].duration||u);c.splice(3,0,c[3].easing||u);c.splice(4,0,c[4].done||c[4].complete||u);c.splice(5,0,c[5].step||u)}else{if(c[2]===a){c.splice(2,0,u);c.splice(3,0,u);c.splice(4,0,u)}else if(p(c[2])){c.splice(2,0,u);c.splice(3,0,u)}if(c[3]===a){c[3]=u;c.splice(4,0,u)}else p(c[3])&&c.splice(3,0,u)}for(i=0;i<n.length;i+=1){r=e(n[i]);f=_(n[i]);if(f){d=W(n[i]);v=r.getLayer(c[0]);if(v&&v._method!==e.fn.draw){m=l({},c[1]);m=it(n[i],v,m);rt(m,s);rt(v);v.style=L;e(v).animate(m,{duration:c[2],easing:e.easing[c[3]]?c[3]:u,complete:g(r,d,v),step:y(r,d,v)})}}}return n};e.fn.animateLayerGroup=function(n){var r=this,i,s,o=[].slice.call(arguments,0),u,a;for(s=0;s<r.length;s+=1){i=e(r[s]);u=i.getLayerGroup(n);if(u)for(a=0;a<u.length;a+=1)i.animateLayer.apply(i,[u[a]].concat(o.slice(1)))}return r};e.fn.delayLayer=function(n,r){var i=this,s,o;r=r||0;for(s=0;s<i.length;s+=1){o=e(i[s]).getLayer(n);e(o).delay(r)}return i};e.fn.delayLayerGroup=function(n,r){var i=this,s,o,u,a,f;r=r||0;for(o=0;o<i.length;o+=1){s=e(i[o]);u=s.getLayerGroup(n);if(u)for(f=0;f<u.length;f+=1){a=u[f];a&&e(a).delay(r)}}return i};e.fn.stopLayer=function(n,r){var i=this,s,o,u;for(o=0;o<i.length;o+=1){s=e(i[o]);u=s.getLayer(n);u&&e(u).stop(r)}return i};e.fn.stopLayerGroup=function(n,r){var i=this,s,o,u,a,f;for(o=0;o<i.length;o+=1){s=e(i[o]);u=s.getLayerGroup(n);if(u)for(f=0;f<u.length;f+=1){a=u[f];a&&e(a).stop(r)}}return i};ut(["color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","outlineColor","strokeStyle","shadowColor"]);w={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};E={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"};ct(["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","touchstart","touchmove","touchend"]);e.event.fix=function(t){var n,r,i;t=b.call(e.event,t);r=t.originalEvent;if(r){i=r.changedTouches;if(t.pageX!==a&&t.offsetX===a){n=e(t.currentTarget).offset();if(n){t.offsetX=t.pageX-n.left;t.offsetY=t.pageY-n.top}}else if(i){n=e(t.currentTarget).offset();if(n){t.offsetX=i[0].pageX-n.left;t.offsetY=i[0].pageY-n.top}}}return t};S={arc:"drawArc",bezier:"drawBezier",circle:"drawArc",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",polygon:"drawPolygon",slice:"drawSlice",quadratic:"drawQuadratic",rectangle:"drawRect",text:"drawText",vector:"drawVector"};e.fn.draw=function Et(t){var n=this,r,i,s,o=new A(t),u;if(S[o.type])n[S[o.type]](t);else for(i=0;i<n.length;i+=1){r=e(n[i]);s=_(n[i]);if(s){o=new A(t);u=tt(n[i],o,t,Et);o.visible&&o.fn&&o.fn.call(n[i],s,o)}}return n};e.fn.clearCanvas=function St(e){var t=this,n,r,i=new A(e),s;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r)if(i.width===u||i.height===u){r.save();r.setTransform(1,0,0,1,0,0);r.clearRect(0,0,t[n].width,t[n].height);r.restore()}else{s=tt(t[n],i,e,St);z(t[n],r,i,i.width,i.height);r.clearRect(i.x-i.width/2,i.y-i.height/2,i.width,i.height);F(r,i)}}return t};e.fn.saveCanvas=function xt(e){var t=this,n,r,i,s,o,u;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r){o=W(t[n]);i=new A(e);s=tt(t[n],i,e,xt);for(u=0;u<i.count;u+=1)P(r,o)}}return t};e.fn.restoreCanvas=function Tt(e){var t=this,n,r,i,s,o,u;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r){o=W(t[n]);i=new A(e);s=tt(t[n],i,e,Tt);for(u=0;u<i.count;u+=1)H(r,o)}}return t};e.fn.restoreCanvasOnRedraw=function(t){var n=this,r=l({},t);r.layer=s;n.restoreCanvas(r);return n};e.fn.rotateCanvas=function Nt(e){var t=this,n,r,i,s,o;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r){o=W(t[n]);i=new A(e);s=tt(t[n],i,e,Nt);i.autosave&&P(r,o);q(r,i,o.transforms)}}return t};e.fn.scaleCanvas=function Ct(e){var t=this,n,r,i,s,o;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r){o=W(t[n]);i=new A(e);s=tt(t[n],i,e,Ct);i.autosave&&P(r,o);R(r,i,o.transforms)}}return t};e.fn.translateCanvas=function kt(e){var t=this,n,r,i,s,o;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r){o=W(t[n]);i=new A(e);s=tt(t[n],i,e,kt);i.autosave&&P(r,o);U(r,i,o.transforms)}}return t};e.fn.drawRect=function Lt(e){var t=this,n,r,i,u,a,f,l,c,h;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r){i=new A(e);u=tt(t[n],i,e,Lt);if(i.visible){B(t[n],r,i);z(t[n],r,i,i.width,i.height);r.beginPath();a=i.x-i.width/2;f=i.y-i.height/2;h=i.cornerRadius;if(h){i.closed=s;l=i.x+i.width/2;c=i.y+i.height/2;l-a-2*h<0&&(h=(l-a)/2);c-f-2*h<0&&(h=(c-f)/2);r.moveTo(a+h,f);r.lineTo(l-h,f);r.arc(l-h,f+h,h,3*v/2,v*2,o);r.lineTo(l,c-h);r.arc(l-h,c-h,h,0,v/2,o);r.lineTo(a+h,c);r.arc(a+h,c-h,h,v/2,v,o);r.lineTo(a,f+h);r.arc(a+h,f+h,h,v,3*v/2,o)}else r.rect(a,f,i.width,i.height);ht(t[n],r,i);I(t[n],r,i)}}}return t};e.fn.drawArc=function At(e){var t=this,n,r,i,s,o,u,a,f,l,c,h,p,d;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r){i=new A(e);s=tt(t[n],i,e,At);if(i.visible){B(t[n],r,i);z(t[n],r,i,i.radius*2);!i.inDegrees&&i.end===360&&(i.end=v*2);i.start*=i._toRad;i.end*=i._toRad;i.start-=v/2;i.end-=v/2;r.beginPath();r.arc(i.x,i.y,i.radius,i.start,i.end,i.ccw);d=v/180*1;i.ccw&&(d*=-1);o=dt(i,i.start+d);u=vt(i,i.start+d);a=dt(i,i.start);f=vt(i,i.start);l=dt(i,i.end+d);c=vt(i,i.end+d);h=dt(i,i.end);p=vt(i,i.end);gt(t[n],r,i,o,u,a,f,h,p,l,c);ht(t[n],r,i);I(t[n],r,i)}}}return t};e.fn.drawEllipse=function Ot(e){var t=this,n,r,i,o,u,a;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r){i=new A(e);o=tt(t[n],i,e,Ot);if(i.visible){B(t[n],r,i);z(t[n],r,i,i.width,i.height);u=i.width*(4/3);a=i.height;r.beginPath();r.moveTo(i.x,i.y-a/2);r.bezierCurveTo(i.x-u/2,i.y-a/2,i.x-u/2,i.y+a/2,i.x,i.y+a/2);r.bezierCurveTo(i.x+u/2,i.y+a/2,i.x+u/2,i.y-a/2,i.x,i.y-a/2);ht(t[n],r,i);i.closed=s;I(t[n],r,i)}}}return t};e.fn.drawPolygon=function Mt(e){var t=this,n,r,i,o,u,a,f,l,c,h,p;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r){i=new A(e);o=tt(t[n],i,e,Mt);if(i.visible){B(t[n],r,i);z(t[n],r,i,i.radius*2);a=2*v/i.sides;f=a/2;u=f+v/2;l=i.radius*g(f);r.beginPath();for(p=0;p<i.sides;p+=1){c=i.x+i.radius*g(u);h=i.y+i.radius*m(u);r.lineTo(c,h);if(i.concavity){c=i.x+(l+ -l*i.concavity)*g(u+f);h=i.y+(l+ -l*i.concavity)*m(u+f);r.lineTo(c,h)}u+=a}ht(t[n],r,i);i.closed=s;I(t[n],r,i)}}}return t};e.fn.drawSlice=function _t(t){var n=this,r,i,o,u,a,f,l,c;for(i=0;i<n.length;i+=1){r=e(n[i]);o=_(n[i]);if(o){u=new A(t);a=tt(n[i],u,t,_t);if(u.visible){B(n[i],o,u);z(n[i],o,u,u.radius*2);u.start*=u._toRad;u.end*=u._toRad;u.start-=v/2;u.end-=v/2;u.start=pt(u.start);u.end=pt(u.end);u.end<u.start&&(u.end+=2*v);f=(u.start+u.end)/2;l=u.radius*u.spread*g(f);c=u.radius*u.spread*m(f);u.x+=l;u.y+=c;o.beginPath();o.arc(u.x,u.y,u.radius,u.start,u.end,u.ccw);o.lineTo(u.x,u.y);ht(n[i],o,u);u.closed=s;I(n[i],o,u)}}}return n};e.fn.drawLine=function Dt(e){var t=this,n,r,i,o,u,f,l;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r){i=new A(e);o=tt(t[n],i,e,Dt);if(i.visible){B(t[n],r,i);z(t[n],r,i,0);u=1;r.beginPath();while(s){f=i["x"+u];l=i["y"+u];if(f===a||l===a)break;r.lineTo(f+i.x,l+i.y);u+=1}u-=1;gt(t[n],r,i,i.x2+i.x,i.y2+i.y,i.x1+i.x,i.y1+i.y,i["x"+(u-1)]+i.x,i["y"+(u-1)]+i.y,i["x"+u]+i.x,i["y"+u]+i.y);ht(t[n],r,i);I(t[n],r,i)}}}return t};e.fn.drawQuadratic=function Pt(e){var t=this,n,r,i,o,u,f,l,c,h;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r){i=new A(e);o=tt(t[n],i,e,Pt);if(i.visible){B(t[n],r,i);z(t[n],r,i,0);u=2;r.beginPath();r.moveTo(i.x1+i.x,i.y1+i.y);while(s){f=i["x"+u];l=i["y"+u];c=i["cx"+(u-1)];h=i["cy"+(u-1)];if(f===a||l===a||c===a||h===a)break;r.quadraticCurveTo(c+i.x,h+i.y,f+i.x,l+i.y);u+=1}u-=1;gt(t[n],r,i,i.cx1+i.x,i.cy1+i.y,i.x1+i.x,i.y1+i.y,i["cx"+(u-1)]+i.x,i["cy"+(u-1)]+i.y,i["x"+u]+i.x,i["y"+u]+i.y);ht(t[n],r,i);I(t[n],r,i)}}}return t};e.fn.drawBezier=function Ht(e){var t=this,n,r,i,o,u,f,l,c,h,p,d,v;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r){i=new A(e);o=tt(t[n],i,e,Ht);if(i.visible){B(t[n],r,i);z(t[n],r,i,0);u=2;f=1;r.beginPath();r.moveTo(i.x1+i.x,i.y1+i.y);while(s){l=i["x"+u];c=i["y"+u];h=i["cx"+f];p=i["cy"+f];d=i["cx"+(f+1)];v=i["cy"+(f+1)];if(l===a||c===a||h===a||p===a||d===a||v===a)break;r.bezierCurveTo(h+i.x,p+i.y,d+i.x,v+i.y,l+i.x,c+i.y);u+=1;f+=2}u-=1;f-=2;gt(t[n],r,i,i.cx1+i.x,i.cy1+i.y,i.x1+i.x,i.y1+i.y,i["cx"+(f+1)]+i.x,i["cy"+(f+1)]+i.y,i["x"+u]+i.x,i["y"+u]+i.y);ht(t[n],r,i);I(t[n],r,i)}}}return t};e.fn.drawVector=function Bt(e){var t=this,n,r,i,o,u,f,l,c,h,p,d,y,b,w,E;for(n=0;n<t.length;n+=1){r=_(t[n]);if(r){i=new A(e);o=tt(t[n],i,e,Bt);if(i.visible){B(t[n],r,i);z(t[n],r,i,0);u=1;r.beginPath();c=y=w=p=i.x;h=b=E=d=i.y;r.moveTo(i.x,i.y);while(s){f=i["a"+u];l=i["l"+u];if(f===a||l===a)break;f*=i._toRad;f-=v/2;y=w;b=E;w+=l*g(f);E+=l*m(f);if(u===1){p=w;d=E}r.lineTo(w,E);u+=1}gt(t[n],r,i,p,d,i.x,i.y,y,b,w,E);ht(t[n],r,i);I(t[n],r,i)}}}return t};e.fn.drawText=function jt(t){var n=this,r,i,s,o,a,f,l,c,h;for(i=0;i<n.length;i+=1){r=e(n[i]);s=_(n[i]);if(s){o=new A(t);a=tt(n[i],o,t,jt);if(o.visible){B(n[i],s,o);s.textBaseline=o.baseline;s.textAlign=o.align;yt(s,o);o.maxWidth!==u?f=wt(s,o):f=o.text.toString().split("\n");bt(n[i],s,o,f);if(t&&o.layer){t.width=o.width;t.height=o.height}z(n[i],s,o,o.width,o.height);c=o.x;o.align==="left"?o.respectAlign?o.x+=o.width/2:c-=o.width/2:o.align==="right"&&(o.respectAlign?o.x-=o.width/2:c+=o.width/2);for(l=0;l<f.length;l+=1){s.shadowColor=o.shadowColor;h=o.y+l*o.height/f.length-(f.length-1)*o.height/f.length/2;s.fillText(f[l],c,h);o.fillStyle!=="transparent"&&(s.shadowColor="transparent");s.strokeText(f[l],c,h)}if(o._event){s.beginPath();s.rect(o.x-o.width/2,o.y-o.height/2,o.width,o.height);ht(n[i],s,o);s.closePath()}F(s,o)}}}T=o;return n};e.fn.measureText=function(t){var n=this,r,i,s;i=n.getLayer(t);if(!i||i&&!i._layer)i=new A(t);r=_(n[0]);if(r){yt(r,i);s=wt(r,i);bt(n[0],r,i,s)}return i};e.fn.drawImage=function Ft(t){function g(e,t,n,i,s){B(r[e],t,i);i.width===u&&i.sWidth===u&&(i.width=i.sWidth=d.width);i.height===u&&i.sHeight===u&&(i.height=i.sHeight=d.height);if(s){s.width=i.width;s.height=i.height}if(i.sWidth!==u&&i.sHeight!==u&&i.sx!==u&&i.sy!==u){i.width===u&&(i.width=i.sWidth);i.height===u&&(i.height=i.sHeight);if(!i.cropFromCenter){i.sx+=i.sWidth/2;i.sy+=i.sHeight/2}i.sy-i.sHeight/2<0&&(i.sy=i.sHeight/2);i.sy+i.sHeight/2>d.height&&(i.sy=d.height-i.sHeight/2);i.sx-i.sWidth/2<0&&(i.sx=i.sWidth/2);i.sx+i.sWidth/2>d.width&&(i.sx=d.width-i.sWidth/2);z(r[e],t,i,i.width,i.height);t.drawImage(d,i.sx-i.sWidth/2,i.sy-i.sHeight/2,i.sWidth,i.sHeight,i.x-i.width/2,i.y-i.height/2,i.width,i.height)}else{z(r[e],t,i,i.width,i.height);t.drawImage(d,i.x-i.width/2,i.y-i.height/2,i.width,i.height)}t.beginPath();t.rect(i.x-i.width/2,i.y-i.height/2,i.width,i.height);ht(r[e],t,i);t.closePath();F(t,i);j(t,n,i)}function y(t,n,r,i,u,a){return function(){g(n,r,i,u,a);u.load&&u.load.call(t,a);if(u.layer){u._args._masks=i.transforms.masks.slice(0);u._next&&e(t).drawLayers({clear:o,resetFire:s,index:u._next})}}}var r=this,i,f,l,c,h,p,d,v,m;for(f=0;f<r.length;f+=1){i=r[f];l=_(r[f]);if(l){c=W(r[f]);h=new A(t);p=tt(r[f],h,t,Ft);if(h.visible){m=h.source;v=m.getContext;if(m.src||v)d=m;else if(m)if(N[m]!==a)d=N[m];else{d=new n;d.src=m;N[m]=d}if(d)if(d.complete||v)y(i,f,l,c,h,p)();else{e(d).bind("load",y(i,f,l,c,h,p));d.src=d.src}}}}return r};e.fn.createPattern=function(r){function h(){l=s.createPattern(a,o.repeat);o.load&&o.load.call(i[0],l)}var i=this,s,o,a,f,l,c;s=_(i[0]);if(s){o=new A(r);c=o.source;if(p(c)){a=e("<canvas />")[0];a.width=o.width;a.height=o.height;f=_(a);c.call(a,f);h()}else{f=c.getContext;if(c.src||f)a=c;else{a=new n;a.src=c}if(a.complete||f)h();else{e(a).bind("load",h);a.src=a.src}}}else l=u;return l};e.fn.createGradient=function(t){var n=this,r,i,s,o=[],f,l,c,h,p,d,v;i=new A(t);r=_(n[0]);if(r){i.x1=i.x1||0;i.y1=i.y1||0;i.x2=i.x2||0;i.y2=i.y2||0;i.r1!==u||i.r2!==u?s=r.createRadialGradient(i.x1,i.y1,i.r1,i.x2,i.y2,i.r2):s=r.createLinearGradient(i.x1,i.y1,i.x2,i.y2);for(h=1;i["c"+h]!==a;h+=1)i["s"+h]!==a?o.push(i["s"+h]):o.push(u);f=o.length;o[0]===u&&(o[0]=0);o[f-1]===u&&(o[f-1]=1);for(h=0;h<f;h+=1){if(o[h]!==u){d=1;v=0;l=o[h];for(p=h+1;p<f;p+=1){if(o[p]!==u){c=o[p];break}d+=1}l>c&&(o[p]=o[h])}else if(o[h]===u){v+=1;o[h]=l+v*((c-l)/d)}s.addColorStop(o[h],i["c"+(h+1)])}}else s=u;return s};e.fn.setPixels=function It(e){var t=this,n,r,i,s,o,a,f,l,c,h;for(r=0;r<t.length;r+=1){n=t[r];i=_(n);if(i){s=new A(e);o=tt(n,s,e,It);z(t[r],i,s,s.width,s.height);if(s.width===u||s.height===u){s.width=n.width;s.height=n.height;s.x=s.width/2;s.y=s.height/2}if(s.width!==0&&s.height!==0){f=i.getImageData(s.x-s.width/2,s.y-s.height/2,s.width,s.height);l=f.data;h=l.length;if(s.each)for(c=0;c<h;c+=4){a={r:l[c],g:l[c+1],b:l[c+2],a:l[c+3]};s.each.call(n,a,s);l[c]=a.r;l[c+1]=a.g;l[c+2]=a.b;l[c+3]=a.a}i.putImageData(f,s.x-s.width/2,s.y-s.height/2);i.restore()}}}return t};e.fn.getCanvasImage=function(t,n){var r=this[0];n===a&&(n=1);return r&&r.toDataURL?r.toDataURL("image/"+t,n):u};e.fn.detectPixelRatio=function(n){var r=this,i,o,u,a,f,l,c,h,p,d;for(u=0;u<r.length;u+=1){o=r[u];i=e(r[u]);a=_(o);d=W(r[u]);if(!d.scaled){f=window.devicePixelRatio||1;l=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;c=f/l;if(c!==1){h=o.width;p=o.height;o.width=h*c;o.height=p*c;o.style.width=h+"px";o.style.height=p+"px";a.scale(c,c)}d.pixelRatio=c;d.scaled=s;n&&n.call(o,c)}}return r};e.support.canvas=e("<canvas />")[0].getContext;O.defaults=f;O.transformShape=z;O.detectEvents=ht;O.closePath=I;e.jCanvas=O})(jQuery,document,Image,Math,parseFloat,!0,!1,null);